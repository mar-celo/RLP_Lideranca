!function l(o,r,n){function a(e,t){if(!r[e]){if(!o[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(s)return s(e,!0);throw(i=new Error("Cannot find module '"+e+"'")).code="MODULE_NOT_FOUND",i}i=r[e]={exports:{}},o[e][0].call(i.exports,function(t){return a(o[e][1][t]||t)},i,i.exports,l,o,r,n)}return r[e].exports}for(var s="function"==typeof require&&require,t=0;t<n.length;t++)a(n[t]);return a}({1:[function(t,e,i){"use strict";var l,o=t("./widgetdefinition"),t=(l=o)&&l.__esModule?l:{default:l};HTMLWidgets.widget(t.default)},{"./widgetdefinition":2}],2:[function(t,e,i){"use strict";var l={name:"plotly",type:"output",initialize:function(t,e,i){return{}},resize:function(t,e,i,l){l.autosize&&(e=l.width||e,i=l.height||i,Plotly.relayout(t,{width:e,height:i}))},renderValue:function(n,r,t){var e=r.layout||{};t.width=e.width,t.height=e.height,t.autosize=e.autosize||!0;crosstalk.var("plotlyCrosstalkOpts").set(r.highlight);"undefined"!=typeof window&&(window.PLOTLYENV=window.PLOTLYENV||{},window.PLOTLYENV.BASE_URL=r.base_url,r.highlight.persistent||(window.onmousemove=function(t){t||window.event,t.shiftKey?(r.highlight.persistent=!0,r.highlight.persistentShift=!0):(r.highlight.persistent=!1,r.highlight.persistentShift=!1)}));var a=document.getElementById(n.id);if(a.setAttribute("rhtmlwidget-status","loading"),HTMLWidgets.addPostRenderHandler(function(){for(var t=document.querySelectorAll(".js-plotly-plot .plotly .modebar"),e=0;e<t.length;e++)t[e].style.zIndex=1}),(r.selectize||r.highlight.dynamic)&&!t.plotly){var i,l=document.createElement("div");if(l.class="plotly-crosstalk-control-panel",l.style="display: flex; flex-wrap: wrap",r.highlight.dynamic&&(i=document.createElement("div"),(d=document.createElement("input")).id=n.id+"-colourpicker",d.placeholder="asdasd",(e=document.createElement("label")).for=d.id,e.innerHTML="Brush color&nbsp;&nbsp;",i.appendChild(e),i.appendChild(d),l.appendChild(i)),r.selectize)for(var o=Object.keys(r.selectize),s=0;s<o.length;s++){var u=document.createElement("div");u.id=o[s],u.style="width: 80%; height: 10%",u.class="form-group crosstalk-input-plotly-highlight";var c=document.createElement("label");c.for=o[s],c.innerHTML=r.selectize[o[s]].group,c.class="control-label";var h=document.createElement("div");(A=document.createElement("select")).multiple=!0,h.appendChild(A),u.appendChild(c),u.appendChild(h),l.appendChild(u)}if(a.parentElement.insertBefore(l,a),r.highlight.dynamic){var p=$("#"+d.id),d=r.highlight.color||[],g={value:d[0],showColour:"both",palette:"limited",allowedCols:d.join(" "),width:"20%",height:"10%"};p.colourpicker({changeDelay:0}),p.colourpicker("settings",g),p.colourpicker("value",g.value);for(var f=r.highlight.ctGroups||[],s=0;s<f.length;s++)crosstalk.group(f[s]).var("plotlySelectionColour").set(p.colourpicker("value"));p.on("change",function(){for(var t=0;t<f.length;t++)crosstalk.group(f[t]).var("plotlySelectionColour").set(p.colourpicker("value"))})}}function y(t){return void 0!==t&&t.hasOwnProperty("points")?t.points.map(function(t){var e={curveNumber:t.curveNumber,pointNumber:t.pointNumber,x:t.x,y:t.y};t.hasOwnProperty("z")&&(e.z=t.z),t.hasOwnProperty("customdata")&&(e.customdata=t.customdata);var i,l=document.getElementById(n.id).data[t.curveNumber];i=l._isSimpleKey?(e.key=l.key,[]):["key"];for(var o=0;o<i.length;o++){var r=l[i[o]];Array.isArray(r)&&("number"==typeof t.pointNumber?e[i[o]]=r[t.pointNumber]:Array.isArray(t.pointNumber)?e[i[o]]=r[t.pointNumber[0]][t.pointNumber[1]]:Array.isArray(t.pointNumbers)&&(e[i[o]]=t.pointNumbers.map(function(t){return r[t]})))}return e}):null}r.config=r.config||{},r.config.cloud||(r.config.modeBarButtonsToRemove=r.config.modeBarButtonsToRemove||[],r.config.modeBarButtonsToRemove.push("sendDataToCloud")),window&&window.self!==window.top&&!C(r)&&(r=JSON.parse(JSON.stringify(r))),t.plotly?_=r.layout.transition?Plotly.react(a,r):(Plotly.purge(a),a.data=void 0,a.layout=void 0,Plotly.newPlot(a,r)):(_=Plotly.newPlot(a,r),t.plotly=!0),_.catch(function(){a.setAttribute("rhtmlwidget-status","ready")}).then(function(){a.setAttribute("rhtmlwidget-status","ready"),HTMLWidgets.shinyMode&&Shiny.addCustomMessageHandler("plotly-calls",function(t){var e=document.getElementById(t.id);if(!e)throw new Error("Couldn't find plotly graph with id: "+t.id);if("reconfig"!=t.method){if(!Plotly[t.method])throw new Error("Unknown method "+t.method);var i=[e].concat(t.args);Plotly[t.method].apply(null,i)}else Plotly.react(e,e.data,e.layout,t.args)});for(var t=a._fullLayout._subplots.mapbox||[],e=0;e<t.length;e++){var i=t[e],l=(r.layout[i]||{})._fitBounds||{};l&&a._fullLayout[i]._subplot.map.fitBounds(l.bounds,l.options)}});var m,v,_=function(t){var e=t.data[t.curveNumber];if(!e.legendgroup)return e;var i=t.data.map(function(t){return t.legendgroup}),l=[];for(s=0;s<i.length;s++)i[s]==e.legendgroup&&l.push(t.data[s]);return l};HTMLWidgets.shinyMode&&Shiny.setInputValue&&(m={plotly_deselect:["plotly_selected","plotly_selecting","plotly_brushed","plotly_brushing","plotly_click"],plotly_unhover:["plotly_hover"],plotly_doubleclick:["plotly_click"]},Object.keys(m).map(function(t){a.on(t,function(){m[t].map(function(t){Shiny.setInputValue(t+"-"+r.source,null,{priority:"event"})})})}),v={plotly_click:y,plotly_sunburstclick:y,plotly_hover:y,plotly_unhover:y,plotly_selected:function(t){if(t)return y(t)},plotly_selecting:function(t){if(t)return y(t)},plotly_brushed:function(t){if(t)return t.range||t.lassoPoints},plotly_brushing:function(t){if(t)return t.range||t.lassoPoints},plotly_legendclick:_,plotly_legenddoubleclick:_,plotly_clickannotation:function(t){return t.fullAnnotation}},(r.shinyEvents||[]).map(function(e){var i=v[e]||function(t){return t||n.id};a.on("plotly_brushed"==e?"plotly_selected":"plotly_brushing"==e?"plotly_selecting":e,function(t){Shiny.setInputValue(e+"-"+r.source,JSON.stringify(i(t)),{priority:"event"})})})),r.highlight.color=r.highlight.color||[],Array.isArray(r.highlight.color)||(r.highlight.color=[r.highlight.color]);for(var b=new D(a,r.highlight),k=[],w=0;w<r.data.length;w++){var S=r.data[w].set;S&&-1===k.indexOf(S)&&k.push(S)}for(s=0;s<k.length;s++){var O=k[s],x=new crosstalk.SelectionHandle(O);new crosstalk.FilterHandle(O).on("change",function(t){T(n),b.updateFilter(O,t.value)});x.on("change",function(t){"plotly_selected"===r.highlight.on&&r.highlight.persistentShift&&(Array.prototype.diff=function(e){return this.filter(function(t){return e.indexOf(t)<0})},t.value=t.value.diff(t.oldValue));var e=crosstalk.var("plotlySelectionHistory").get()||[],i={receiverID:b.gd.id,plotlySelectionColour:crosstalk.group(O).var("plotlySelectionColour").get()};if(i[O]=t.value,0<e.length)for(var l=JSON.stringify(i),o=0;o<e.length;o++)if(JSON.stringify(e[o])==l)return;r.highlight.persistent?e.push(i):e=[i],crosstalk.var("plotlySelectionHistory").set(e),b.updateSelection(O,t.value),r.selectize&&(r.highlight.persistent&&null!==t.value||P.clear(!0),P.addItems(t.value,!0),P.close())});var N,A,P,E=function(t){if(t){var e,i=function(t){for(var e={},i=0;i<t.length;i++){var l,o=a.data[t[i].curveNumber];o.key&&o.set&&(e[o.set]=e[o.set]||{value:[],_isSimpleKey:o._isSimpleKey},l="number"==typeof(l=t[i].pointNumber)?l:t[i].pointNumbers,l=o._isSimpleKey?o.key:Array.isArray(l)?l.map(function(t){return o.key[t]}):o.key[l],l=o._isNestedKey?[].concat.apply([],l):l,e[o.set].value=e[o.set].value.concat(l))}return e}(t.points);for(e in i)i.hasOwnProperty(e)&&x.set(i[e].value,{sender:n})}};0<r.highlight.debounce&&(E=function(l,o,r){var n;return function(){var t=this,e=arguments,i=r&&!n;clearTimeout(n),n=setTimeout(function(){n=null,r||l.apply(t,e)},o),i&&l.apply(t,e)}}(E,r.highlight.debounce)),a.on(r.highlight.on,E),a.on(r.highlight.off,function(t){T(n),crosstalk.var("plotlySelectionHistory").set(null),x.set(null,{sender:n})}),r.selectize&&(N=Object.keys(r.selectize)[s],E=r.selectize[N].items,g={options:[{value:"",label:"(All)"}].concat(E),searchField:"label",valueField:"value",labelField:"label",maxItems:50},A=$("#"+N).find("select")[0],(P=$(A).selectize(g)[0].selectize).on("change",function(){var e=b.groupSelections[O]||[];if(!r.highlight.persistent){T(n);for(var t=0;t<e.length;t++)P.removeItem(e[t],!0)}var i=P.items.filter(function(t){return e.indexOf(t)<0});0<i.length?b.updateSelection(O,i):(b.updateSelection(O,null),b.updateSelection(O,P.items))}))}a.on("plotly_afterplot",function(){a.setAttribute("rhtmlwidget-status","ready")})}};function D(t,e){this.gd=t,this.origData=JSON.parse(JSON.stringify(t.data)),this.origOpacity=[];for(var i=0;i<this.origData.length;i++)this.origOpacity[i]=0===this.origData[i].opacity?0:this.origData[i].opacity||1;this.groupSelections={},this.highlight=e}function y(t){return t._isNestedKey?r:t._isSimpleKey?o:m}function m(t,i){var l=[];return t.forEach(function(t,e){(null===t||0<=i.indexOf(t))&&l.push(e)}),l}function o(t,e){return t.every(function(t){return null===t||0<=e.indexOf(t)})?[0]:[]}function r(t,e){for(var i=[],l=0;l<t.length;l++)t[l].every(function(t){return null===t||0<=e.indexOf(t)})&&i.push(l);return i}function C(t){return"[object Object]"===Object.prototype.toString.call(t)&&Object.getPrototypeOf(t)===Object.prototype}function v(i,l){var o={};return Object.keys(i).forEach(function(t){var e=i[t];"_"===t.charAt(0)?o[t]=e:"transforms"===t&&Array.isArray(e)?o[t]=e.map(function(t){return v(t,l)}):"colorscale"===t&&Array.isArray(e)?o[t]=e:C(e)?o[t]=v(e,l):Array.isArray(e)?o[t]=function(t,e){for(var i=[],l=0;l<e.length;l++)i.push(t[e[l]]);return i}(e,l):o[t]=e}),o}function T(t){for(var e=t.querySelectorAll(".select-outline"),i=0;i<e.length;i++)e[i].remove()}D.prototype.close=function(){},D.prototype.updateFilter=function(t,e){if(null==e)this.gd.data=JSON.parse(JSON.stringify(this.origData));else{for(var i=[],l=0;l<this.origData.length;l++){var o,r=this.origData[l];r.key&&r.set===t&&(0<(o=y(r)(r.key,e)).length&&(r._isSimpleKey||(r=v(r,o)),i.push(r)))}this.gd.data=i}Plotly.redraw(this.gd)},D.prototype.updateSelection=function(h,p){if(null!==p&&!Array.isArray(p))throw new Error("Invalid keys argument; null or array expected");var t=this.gd.data.length-this.origData.length;if(null===p||!this.highlight.persistent&&0<t){for(var e=[],i=0;i<this.gd.data.length;i++)this.gd.data[i]._isCrosstalkTrace&&e.push(i);Plotly.deleteTraces(this.gd,e),this.groupSelections[h]=p}else{this.groupSelections[h]=this.groupSelections[h]||[];for(i=0;i<p.length;i++){var l=p[i];this.groupSelections[h].indexOf(l)<0&&this.groupSelections[h].push(l)}}if(null===p)Plotly.restyle(this.gd,{opacity:this.origOpacity});else if(1<=p.length){for(var d=[],o=crosstalk.group(h).var("plotlySelectionColour").get()||this.highlight.color[0],i=0;i<this.origData.length;i++){var r,g=JSON.parse(JSON.stringify(this.gd.data[i]));g.key&&g.set===h&&0<(c=y(g)(g.key,p)).length&&(g._isSimpleKey||(g=v(g,c)),r=this.gd._fullData[i],$.extend(!0,g,this.highlight.selected),r.marker&&(g.marker=g.marker||{},g.marker.color=o||g.marker.color||r.marker.color),r.line&&(g.line=g.line||{},g.line.color=o||g.line.color||r.line.color),r.textfont&&(g.textfont=g.textfont||{},g.textfont.color=o||g.textfont.color||r.textfont.color),r.fillcolor&&(g.fillcolor=o||g.fillcolor||r.fillcolor),g.name=g.name||p.join("<br />"),g.legendgroup=g.legendgroup||p.join("<br />"),g._originalIndex=i,g._newIndex=this.gd._fullData.length+d.length,g._isCrosstalkTrace=!0,d.push(g))}if(0<d.length){Plotly.addTraces(this.gd,d).then(function(t){for(var e=t._transitionData._frameHash,i=t._transitionData._frames||[],l=0;l<i.length;l++){for(var o=[],r=0;r<d.length;r++){var n=d[r];-1<i[l].traces.indexOf(n._originalIndex)&&(o.push(n._newIndex),i[l].traces.push(n._newIndex))}if(0!==o.length){for(var a=0,s=i[l].data.length,r=0;r<s;r++){var u,c=i[l].data[r];c.key&&c.set===h&&(0<(u=y(c)(c.key,p)).length&&(g._isSimpleKey||(c=v(c,u)),(u=t._fullData[o[a]]).marker&&(c.marker=u.marker),u.line&&(c.line=u.line),u.textfont&&(c.textfont=u.textfont),a+=1,i[l].data.push(c)))}e[i[l].name]=i[l]}}});for(var n=[],a=[],s=Object.keys(this.groupSelections),u=this.origData.length,i=0;i<u;i++){var c,f=this.origOpacity[i]||1;f===this.gd._fullData[i].opacity&&1!==this.highlight.opacityDim&&(c=m(s,[this.gd.data[i].set])).length&&(n.push(i),a.push(f*this.highlight.opacityDim))}0<n.length&&(Plotly.restyle(this.gd,{opacity:a},n),Plotly.restyle(this.gd,{selectedpoints:null}))}}},e.exports=l},{}]},{},[1]);
//# sourceMappingURL=plotly.js.map
